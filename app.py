import streamlit as st
import pandas as pd
import math

st.set_page_config(page_title="Payroll Pro - Î ÏÎ¿ÏƒÏ‡Î­Î´Î¹Î¿", layout="wide")

# Î£Ï„Ï…Î» Î³Î¹Î± Ï„Î± ÎºÏŒÎºÎºÎ¹Î½Î± Î³ÏÎ¬Î¼Î¼Î±Ï„Î± ÏƒÎµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· ÏƒÏ†Î¬Î»Î¼Î±Ï„Î¿Ï‚
st.markdown("""
    <style>
    .error-text { color: #FF0000; font-weight: bold; font-size: 20px; }
    .success-text { color: #008000; font-weight: bold; }
    </style>
    """, unsafe_allow_html=True)

# --- Î¥Ï€Î¿Î¸ÎµÏ„Î¹ÎºÎ­Ï‚ ÏƒÏ„Î±Î¸ÎµÏÎ­Ï‚ Î±Ï€ÏŒ Ï„Î¿ Excel ÏƒÎ¿Ï… (D265, D267, ÎºÎ»Ï€) ---
D265_CONST = 1000.00  # 8Î¿ ÎºÎ»Î¹Î¼Î¬ÎºÎ¹Î¿ (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±)
D267_CONST = 600.00   # Î’Î¬ÏƒÎ· Î‘Î½Î¸Ï…Î³Î¹ÎµÎ¹Î½Î¿Ï (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±)
E11_CONST = 800.00    # Î£Ï„Î±Î¸ÎµÏÎ¬ Î³Î¹Î± Î•Ï€Î¯Î´Î¿Î¼Î± Î“Î¬Î¼Î¿Ï… (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±)
D182_DEFAULT = 5.40   # Î—Î¼ÎµÏÎ®ÏƒÎ¹Î± Î¤ÏÎ¿Ï†Î®

st.title("ğŸš€ Payroll Calculator (Draft v2)")

# --- 1. Î¥Î ÎŸÎ Î›Î‘Î™Î£Î™ÎŸ Î©Î¡Î©Î (D17, D18, D19) ---
with st.container(border=True):
    st.subheader("ğŸ•’ ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î©ÏÏÎ½ ÎœÎ®Î½Î±")
    col1, col2, col3 = st.columns(3)
    
    with col1:
        d17 = st.number_input("ÎÏÎµÏ‚ ÎšÎ±Î½. Î‘Ï€Î±ÏƒÏ‡ÏŒÎ»Î·ÏƒÎ·Ï‚ (D17)", value=162.50, step=0.5)
    with col2:
        d18 = st.number_input("ÎÏÎµÏ‚ ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ Î†Î´ÎµÎ¹Î±Ï‚ (D18)", value=0.0, step=0.5)
    with col3:
        d19 = st.number_input("ÎÏÎµÏ‚ Î”Î¹ÎºÎ±Î¹Î¿Î»Î¿Î³Î·Î¼Î­Î½Î·Ï‚ Î‘Ï€Î¿Ï…ÏƒÎ¯Î±Ï‚ (D19)", value=0.0, step=0.5)
    
    g19 = d17 + d18 + d19
    
    if g19 != 162.50:
        st.markdown(f'<p class="error-text">âš ï¸ Î Î¡ÎŸÎ£ÎŸÎ§Î—: Î£ÏÎ½Î¿Î»Î¿ Î©ÏÏÎ½ {g19:.2f} (Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ 162.50)</p>', unsafe_allow_html=True)
    else:
        st.markdown('<p class="success-text">âœ… Î£ÏÎ½Î¿Î»Î¿ Î©ÏÏÎ½ ÏƒÏ‰ÏƒÏ„ÏŒ (162.50)</p>', unsafe_allow_html=True)

# --- 2. Î›ÎŸÎ™Î Î•Î£ Î Î‘Î¡Î‘ÎœÎ•Î¤Î¡ÎŸÎ™ (Sidebar) ---
with st.sidebar:
    st.header("âš™ï¸ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚")
    d5_val = st.number_input("Î’Î±ÏƒÎ¹ÎºÏŒÏ‚ (E5)", value=1200.00)
    d7_choice = st.checkbox("Î•Ï€Î¯Î´Î¿Î¼Î± Î“Î¬Î¼Î¿Ï…", value=True)
    d22_choice = st.selectbox("ÎŸÎ¹Îº. Î’Î¬ÏÎ· (D22)", [0, 1, 2, 3, 4, 5])
    d182 = st.number_input("Î‘Ï€Î¿Î¶Î·Î¼Î¯Ï‰ÏƒÎ· Î¤ÏÎ¿Ï†Î®Ï‚ (D182)", value=D182_DEFAULT)
    
    st.divider()
    st.subheader("Î ÏÏŒÏƒÎ¸ÎµÏ„ÎµÏ‚ ÎÏÎµÏ‚")
    d29 = st.number_input("ÎÏÎµÏ‚ Î¥Ï€ÎµÏÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ (D29)", value=0.0)
    d30 = st.number_input("ÎÏÎµÏ‚ Î¥Ï€ÎµÏÏ‰ÏÎ¯Î±Ï‚ 1.4 (D30)", value=0.0)
    d31 = st.number_input("ÎÏÎµÏ‚ Î¥Ï€ÎµÏÏ‰ÏÎ¯Î±Ï‚ Î§.Î‘. 1.2 (D31)", value=0.0)

# --- 3. Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ™ (Logic) ---

# Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î‘Ï€Î¿Î´Î¿Ï‡Î­Ï‚ (Î‘Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Î³Î¹Î± Ï„Î¿ Ï€ÏÎ¿ÏƒÏ‡Î­Î´Î¹Î¿)
e5 = d5_val
e7 = (E11_CONST * 0.10) if d7_choice else 0.0
e14 = e5 + e7 # ÎšÎ±Ï„Î±Î²Î±Î»Î»ÏŒÎ¼ÎµÎ½ÎµÏ‚

# Î©ÏÎ¿Î¼Î¯ÏƒÎ¸Î¹Î±
d175 = e14 / 162.50 # Î‘Ï€Î»ÏŒ
d177_base_elements = e14 + (D265_CONST * 0.1136) # Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: E14 + Î’Î¬ÏÎ´Î¹Î±
# Î•Î´Ï Î¸Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎ¿Ï…Î¼Îµ ÎºÎ±Î¹ Ï„Î¿ E22 Î¼ÏŒÎ»Î¹Ï‚ Î¿ÏÎ¹ÏƒÏ„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯
d177 = d177_base_elements / 162.50 # Î©ÏÎ¿Î¼Î¯ÏƒÎ¸Î¹Î¿ Î¥Ï€ÎµÏÏ‰ÏÎ¯Î±Ï‚

# Î¥Ï€ÎµÏÏ‰ÏÎ¯ÎµÏ‚ (Î“ÏÎ±Î¼Î¼Î­Ï‚ 29, 30, 31)
e29 = (d177 * d29) * 1.20
e30 = d30 * d177 * 1.40
e31 = (d177 * d31) * 1.20

# Î¤ÏÎ¿Ï†Î® (Î“ÏÎ±Î¼Î¼Î® 182)
e182 = (g19 / 6.66) * d182

# --- 4. Î Î‘Î¡ÎŸÎ¥Î£Î™Î‘Î£Î— (Display) ---
st.divider()
c1, c2 = st.columns(2)

with c1:
    st.subheader("ğŸ’° ÎšÏÏÎ¹ÎµÏ‚ Î‘Ï€Î¿Î´Î¿Ï‡Î­Ï‚")
    st.write(f"ÎšÎ±Ï„Î±Î²Î±Î»Î»ÏŒÎ¼ÎµÎ½ÎµÏ‚ (E14): **{e14:.2f} â‚¬**")
    st.write(f"Î‘Ï€Î¿Î¶Î·Î¼Î¯Ï‰ÏƒÎ· Î¤ÏÎ¿Ï†Î®Ï‚ (E182): **{e182:.2f} â‚¬**")
    st.write(f"Î©ÏÎ¿Î¼Î¯ÏƒÎ¸Î¹Î¿ Î¥Ï€ÎµÏÏ‰ÏÎ¯Î±Ï‚ (D177): **{d177:.4f} â‚¬**")

with c2:
    st.subheader("â• Î ÏÏŒÏƒÎ¸ÎµÏ„Î± & Î¥Ï€ÎµÏÏ‰ÏÎ¯ÎµÏ‚")
    data = {
        "Î•Î¯Î´Î¿Ï‚": ["Î¥Ï€ÎµÏÎµÏÎ³Î±ÏƒÎ¯Î± (E29)", "Î¥Ï€ÎµÏÏ‰ÏÎ¯Î± 1.4 (E30)", "Î¥Ï€ÎµÏÏ‰ÏÎ¯Î± Î§.Î‘. (E31)"],
        "ÎÏÎµÏ‚": [d29, d30, d31],
        "Î Î¿ÏƒÏŒ (â‚¬)": [f"{e29:.2f}", f"{e30:.2f}", f"{e31:.2f}"]
    }
    st.table(pd.DataFrame(data))

st.caption("Î‘Î½Î±Î¼Î¿Î½Î® Î³Î¹Î± Ï„Î¹Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ 32-43 Î³Î¹Î± Ï„Î·Î½ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·.")
