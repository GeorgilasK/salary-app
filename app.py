import streamlit as st

st.set_page_config(layout="wide", page_title="Payroll Professional v21")

# --- CSS: Î£ÎšÎŸÎ¥Î¡ÎŸ Î“ÎšÎ¡Î™ Î¦ÎŸÎÎ¤ÎŸ & Î›Î•Î¥ÎšÎ‘ Î“Î¡Î‘ÎœÎœÎ‘Î¤Î‘ ---
st.markdown("""
    <style>
    .stApp { background-color: #1e1e1e; }
    .excel-row {
        border: 1px solid #444;
        padding: 10px;
        margin-bottom: 5px;
        background-color: #2d2d2d;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }
    /* Î›ÎµÏ…ÎºÎ¬ Î³ÏÎ¬Î¼Î¼Î±Ï„Î± Ï€Î±Î½Ï„Î¿Ï */
    span, div, p, label, h1, h2, h3 { color: #ffffff !important; }
    
    .col-b { width: 25%; font-weight: bold; }
    .col-d { width: 15%; }
    .col-e { width: 15%; font-weight: bold; color: #4ade80 !important; text-align: right; }
    .col-f { width: 20%; font-size: 0.85rem; color: #cccccc !important; }
    .col-g { width: 25%; font-size: 0.85rem; color: #aaaaaa !important; }

    /* Inputs: ÎœÎ±ÏÏÎ¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¼Î­ÏƒÎ± ÏƒÎµ Î»ÎµÏ…ÎºÏŒ/Î³ÎºÏÎ¹ Ï€ÎµÎ´Î¯Î¿ Î³Î¹Î± Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï„Î¹ Î³ÏÎ¬Ï†ÎµÎ¹Ï‚ */
    input, .stSelectbox div div { color: #000000 !important; background-color: #ffffff !important; }
    </style>
    """, unsafe_allow_html=True)

# --- Î”Î•Î”ÎŸÎœÎ•ÎÎ‘ Î Î™ÎÎ‘ÎšÎ©Î (Î‘ÎºÏÎ¹Î²Î® Î±Ï€ÏŒ Excel) ---
KLIMAKIA = {
    "1": 2234.94, "2": 2187.53, "3": 2087.69, "4": 1963.82, "5": 1892.43, "6": 1717.38, 
    "7": 1667.92, "8": 1570.34, "9": 1454.83, "10": 1424.81, "11": 1376.89, "12": 1350.16, 
    "13": 1321.14, "14": 1309.80, "15": 1299.21, "16": 1285.07, "17": 1275.99, "18": 1266.41, 
    "19": 1258.08, "20": 1224.28, "21": 1216.95, "22": 1202.63, "23": 1195.82, "Î‘": 2589.31, "Î’": 2508.87
}
CHILD_VALS = {0: 0.0, 1: 29.35, 2: 58.70, 3: 91.09, 4: 155.69, 5: 220.29}

def fmt(val):
    return f"{val:,.2f} â‚¬".replace(",", "X").replace(".", ",").replace("X", ".")

st.title("ğŸ“‘ salary_calc.xlsx (Î“ÏÎ±Î¼Î¼Î­Ï‚ 1-290)")

# --- Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î“Î™Î‘ Î‘Î¥Î¤ÎŸÎœÎ‘Î¤Î— Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ Î Î›Î‘Î™Î£Î™ÎŸÎ¥ ---
def excel_line(row_id, desc, input_obj=None, result=0.0, f_txt="", g_txt=""):
    with st.container():
        cols = st.columns([3, 1.5, 2, 2.5, 3])
        with cols[0]: st.markdown(f"**{row_id}: {desc}**")
        
        d_val = input_obj # Î‘Î½ ÎµÎ¯Î½Î±Î¹ widget, Ï„Î¿ Ï€Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Î­Ï„Î¿Î¹Î¼Î¿
        
        with cols[2]: st.markdown(f"<span style='color:#4ade80; font-size:1.2rem;'>{fmt(result)}</span>", unsafe_allow_html=True)
        with cols[3]: st.write(f_txt)
        with cols[4]: st.write(g_txt)
        st.markdown("<hr style='margin:5px; border:0.5px solid #444'>", unsafe_allow_html=True)

# --- 1. Î•ÎÎŸÎ¤Î—Î¤Î‘: Î’Î‘Î£Î™ÎšÎ‘ (5-14) ---
st.header("1. Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î‘Ï€Î¿Î´Î¿Ï‡Î­Ï‚")

# D5 Dropdown
d5_sel = st.selectbox("5: ÎœÎ™Î£Î˜ÎŸÎ›ÎŸÎ“Î™ÎšÎŸ ÎšÎ›Î™ÎœÎ‘ÎšÎ™ÎŸ (D5)", options=list(KLIMAKIA.keys()), index=8)
e5 = KLIMAKIA[d5_sel]
excel_line(5, "ÎœÎ™Î£Î˜ÎŸÎ›ÎŸÎ“Î™ÎšÎŸ ÎšÎ›Î™ÎœÎ‘ÎšÎ™ÎŸ", None, e5, "ÎµÏ€Î¹Î»Î¿Î³Î® Î±Ï€ÏŒ Ï€Î¯Î½Î±ÎºÎ± D254:D280", "")

# D6 Input
d6 = st.number_input("6: Î§Î¡ÎŸÎÎŸÎ•Î Î™Î”ÎŸÎœÎ‘ (ÎˆÏ„Î·) (D6)", value=14)
e6 = d6 * 0.025 * e5
excel_line(6, "Î§Î¡ÎŸÎÎŸÎ•Î Î™Î”ÎŸÎœÎ‘", None, e6, "=D6*2,5%*E5", "ÎµÏ„Î· ÎµÏÎ³Î±ÏƒÎ¹Î±Ï‚ , Î¼ÎµÎ¹Î¿Î½ Ï„Î·Î½ Ï„ÏÎ¹ÎµÏ„Î¹Î± 2012-2014")

e11 = e5 + e6
excel_line(11, "Î’Î‘Î£Î™ÎšÎŸÎ£ ÎœÎ™Î£Î˜ÎŸÎ£", None, e11, "=SUM(E5:E6)", "")

# D7 Dropdown
d7_sel = st.selectbox("7: Î•Î Î™Î”ÎŸÎœÎ‘ Î“Î‘ÎœÎŸÎ¥ (D7)", ["NAI", "OXI", "Î§Î—Î¡Î•Î™Î‘", "Î”Î™Î‘Î–Î•Î¥Î“ÎœÎ•ÎÎŸÎ£/Î—"], index=0)
e7 = e11 * 0.10 if d7_sel != "OXI" else 0.0
excel_line(7, "Î•Î Î™Î”ÎŸÎœÎ‘ Î“Î‘ÎœÎŸÎ¥", None, e7, '=IF(D7="NAI";E11*10%;0)', "")

e8 = 239.08 # Î£Ï„Î±Î¸ÎµÏÏŒ Î‘Î½Î¸Ï…Î³Î¹ÎµÎ¹Î½ÏŒ
e14 = e11 + e7 + e8 # Î‘Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ ÎšÎ±Ï„Î±Î²Î±Î»Î»ÏŒÎ¼ÎµÎ½ÎµÏ‚
excel_line(14, "ÎšÎ‘Î¤Î‘Î’Î‘Î›ÎŸÎœÎ•ÎÎ•Î£ Î‘Î ÎŸÎ”ÎŸÎ§Î•Î£", None, e14, "=E11+E12", "")

d177 = e14 / 162.5 # Î©ÏÎ¿Î¼Î¯ÏƒÎ¸Î¹Î¿ (Î’Î¬ÏƒÎ· Î³Î¹Î± ÏŒÎ»Î± Ï„Î± ÎµÏ€ÏŒÎ¼ÎµÎ½Î±)

# --- 2. Î•ÎÎŸÎ¤Î—Î¤Î‘: Î Î¡ÎŸÎ£Î‘Î¥ÎÎ—Î£Î•Î™Î£ (29-55) ---
st.header("2. Î ÏÎ¿ÏƒÎ±Ï…Î¾Î®ÏƒÎµÎ¹Ï‚ & Î¥Ï€ÎµÏÏ‰ÏÎ¯ÎµÏ‚")

d29 = st.number_input("29: 41 Î¥Î Î•Î¡Î•Î¡Î“Î‘Î£Î™Î‘ 20% (Î©ÏÎµÏ‚) (D29)", value=0.0)
e29 = d177 * d29 * 1.20
excel_line(29, "41 Î¥Î Î•Î¡Î•Î¡Î“Î‘Î£Î™Î‘ 20%", None, e29, "D177*D29*120%", "")

d33 = st.number_input("33: Î Î¡ÎŸÎ£Î‘Î¥ÎÎ—Î£Î— ÎÎ¥Î§Î¤Î‘Î£ (Î©ÏÎµÏ‚) (D33)", value=0.0)
e33 = (e14 / 162.5) * d33 * 0.25
excel_line(33, "Î Î¡ÎŸÎ£Î‘Î¥ÎÎ—Î£Î— ÎÎ¥Î§Î¤Î‘Î£", None, e33, "(E14/162,5)*D33*25%", "")

d38 = st.number_input("38: Î Î¡ÎŸÎ£Î‘Î¥ÎÎ—Î£Î— ÎšÎ¥Î¡Î™Î‘ÎšÎ©Î (Î©ÏÎµÏ‚) (D38)", value=0.0)
e38 = (e14 / 162.5) * d38 * 0.75
excel_line(38, "Î Î¡ÎŸÎ£Î‘Î¥ÎÎ—Î£Î— ÎšÎ¥Î¡Î™Î‘ÎšÎ©Î - Î‘Î¡Î“Î™Î©Î", None, e38, "(E14/162,5)*D38*75%", "")

# --- 3. Î•ÎÎŸÎ¤Î—Î¤Î‘: ÎšÎ¡Î‘Î¤Î—Î£Î•Î™Î£ (59-72) ---
st.header("3. ÎšÏÎ±Ï„Î®ÏƒÎµÎ¹Ï‚ & Î¦ÏŒÏÎ¿Ï‚")

e56 = e14 + e29 + e33 + e38 # Î£ÏÎ½Î¿Î»Î¿ ÎœÎ¹ÎºÏ„ÏÎ½
excel_line(56, "Î£Î¥ÎÎŸÎ›ÎŸ ÎœÎ™ÎšÎ¤Î©Î", None, e56, "=SUM(E17:E55)", "")

e59 = e14 * 0.1682
excel_line(59, "Î•Î¦ÎšÎ‘ (16,82%)", None, e59, "E14 * 16,82%", "ÎšÏÎ±Ï„Î®ÏƒÎµÎ¹Ï‚")

# Î¦ÏŒÏÎ¿Ï‚ (Î“ÏÎ±Î¼Î¼Î® 61) - Î‘Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î»Î¿Î³Î¹ÎºÎ® 17 Î¼Î¹ÏƒÎ¸ÏÎ½
e61 = ( (e56 - e59) * 17 * 0.20 ) / 17 # Î•Î½Î´ÎµÎ¹ÎºÏ„Î¹ÎºÏŒÏ‚ 20% Ï†ÏŒÏÎ¿Ï‚
excel_line(61, "Î¦ÎŸÎ¡ÎŸÎ£", None, e61, "Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ 17 Î¼Î¹ÏƒÎ¸ÏÎ½", "")

# --- Î¤Î•Î›Î™ÎšÎŸ Î Î›Î—Î¡Î©Î¤Î•ÎŸ ---
e79 = e56 - e59 - e61
st.success(f"79: Î Î›Î—Î¡Î©Î¤Î•ÎŸ Î ÎŸÎ£ÎŸ: {fmt(e79)}")

# --- 4. Î•ÎÎŸÎ¤Î—Î¤Î‘: Î”Î©Î¡Î‘ (180-290) ---
st.header("4. Î”ÏÏÎ± & Î•Ï€Î¹Î´ÏŒÎ¼Î±Ï„Î±")
excel_line(180, "Î”Î©Î¡ÎŸ Î§Î¡Î™Î£Î¤ÎŸÎ¥Î“Î•ÎÎÎ©Î", None, e14, "Î’Î‘Î£Î™ÎšÎŸÎ£ + Î Î¡ÎŸÎ£Î‘Î¥ÎÎ—Î£Î•Î™Î£", "")
